# Разработка 1C приложений (конфигураций 1С)

## Язык программирования и структура проекта

В разрабатываемых проектах используется язык программирования 1C (BSL).

### Особенности проектов на 1С
Достаточная часть задач покрывается типовыми конфигурациями - готовыми решениями от 1С и партнеров, поэтому обычно проект сводится к адаптации конфигурации под нужды компании, а не к разработке решения самостоятельно.

### Выбор среды разработки
В зависимости от задач и подхода к проекту есть 2 варианта среды разработки - конфигуратор 1С и EDT - IDE на базе Eclips.
Для проектов до 25 разработчиков в команде имеет смысл использовать конфигуратор, если корректно описать регламенты взаимодействия с хранилищем конфигурации 1С.
Для проектов от 25 разработчиками можно рассмотреть использование EDT.

## Фреймворки

В зависимости от типа модуля используется соответствующий фреймворк:

| **Тип модуля**                                 | **Название фреймворка**                               | **Ссылка на репозитарий и документацию**                       |
| ---------------------------------------------- | ----------------------------------------------------- | -------------------------------------------------------------- |
| Монолит, веб-приложение, мобильное приложение  | 1С:Предприятие (Платформа 1С)                         | [https://v8.1c.ru/](https://v8.1c.ru/), [https://its.1c.ru/db/v838doc/browse/13/-1/5](https://its.1c.ru/db/v838doc/browse/13/-1/5) |
| Веб-приложение                                 | 1С:Предприятие.Элемент                                | [https://v8.1c.ru/platforma/1s-predpriyatie-element/](https://v8.1c.ru/platforma/1s-predpriyatie-element/)            |
| Dev-Ops                                        | 1С:Исполнитель                                        | [https://v8.1c.ru/platforma/1s-ispolnitel-dlya-administratorov/](https://v8.1c.ru/platforma/1s-ispolnitel-dlya-administratorov/)            |


## Библиотеки

| **Решаемая задача**                            | **Название библиотеки**                               | **Ссылка на репозитарий и документацию**                       |
| ---------------------------------------------- | ----------------------------------------------------- | -------------------------------------------------------------- |
| Универсальный базовый функционал для всех конфигураций | БСП (Библиотека стандартных подсистем)        | [https://its.1c.ru/db/bsp3110doc](https://its.1c.ru/db/bsp3110doc)|                                                
| Интеграция с подключаемым оборудованием        | БПО (Библиотека подключаемого оборудования)           | [https://its.1c.ru/db/bpodoc](https://its.1c.ru/db/bpodoc)     |
| Электронный документооборот (ЭДО)              | БЭД (Библиотека электронных документов)               | [https://its.1c.ru/db/bed1914doc](https://its.1c.ru/db/bed1914doc)|
| Работа в модели сервиса                        | БТС (Библиотека технологии сервиса)                   | [https://its.1c.ru/db/smtl](https://its.1c.ru/db/smtl)       |
| Поддержка работы с сервисами ИТС               | БИП (Библиотека интернет-поддержки пользователей)     | [https://its.1c.ru/db/uisldoc#content:372:hdoc](https://its.1c.ru/db/uisldoc#content:372:hdoc)    |

## Основные положения

1. Код должен соответствовать "1С:Предприятие 8. Система стандартов и методик разработки конфигураций" - [https://its.1c.ru/db/v8std](https://its.1c.ru/db/v8std)
2. В проекте должна использоваться самая свежая стабильная версия языка - 1С:Предприятие 8.3.25+, управляемые формы
3. В проекте должны использоваться рекомендуемые вендором версии библиотек
4. Необходимо стараться избегать использования нестандартных подходов к разработке
5. Еженедельно для всех приложений, находящихся на поддержке, производится проверка наличия обновлений от вендора
6. Код должен быть отформатирован в соответствии со станадртами разработки 1С
7. Во любых конфигурационных файлах **[запрещается]** использование IP за редким исключением - обязательно должны быть прописаны доменные имена для всех серверов
8. Серверная часть 1С должна быть отделена от сервера БД
9. Для работы в режиме веб-клиента обязательно шифрование на веб-сервере
10. Должен использоваться мониторинг - 1С:КИП (Корпоративный инструментальный пакет), счетчики производительности Windows, Grafana/Zabbix
11. Обязательно использование хранилища конфигурации 1С (в случае работы в конфигураторе 1С) или git-репозитария в случае работы в EDT
12. Использовать SonarQube с плагином BSL для статистического анализа кода.

## Наилучшие практики

1. В начале выбрать технологию внедрения - ТКВ (технология корпоративного внедрения), ТБР (Технология быстрого результата) или Технологию стандартного внедрения (ТСВ) - [https://1c.ru/uk-part/uk/qual/technology](https://1c.ru/uk-part/uk/qual/technology) и придерживаться её
2. Первично необходимо оценить возможность применения типового решения в рамках задач проекта, а не начинать с разработки собственного решения, даже если на первый взгляд типовое решение не устраивает
3. Вынести на отдельны1 сервера 1С (не обязательно отдельные сервера БД) базы, работающие в контуре регламентированного учета - 1С:Бухгалтерия предприятия (БП), 1С:Зарплата и управление персоналом (ЗУП), и отделить их от сервера 1С управленческих конфигураций - 1С:ERP, 1C:УТ, 1С:КА, 1С:УПП
4. Для работы с JSON/XML использовать встроенный объект `СериализаторXDTO`
5.  Обработка ошибок должна быть явной, с применением конструкции Попытка ... Исключение ... ПодробноеОписаниеОшибки() ... КонецПопытки для добавления контекста к ошибкам и с использованием записей в журнал регистрации
6. Именование переменных:
   - Понятные имена для локальных переменных (РеализацияСсылка, ЗаказКлиентаОбъект)
   - Минимизация глобальных переменных
   - Избегать сокращений кроме общепринятых (HTTP, URL и т.д.)
7. Организация кода:
   - Группировать связанные по контексту функции в одном модуле, в соответствии со Стандартами разработки
   - Разделять логику бизнес-слоя от кода пользовательского интерфейса
   - Не размещать бизнес-логику расчетов в клиентских модулях - в т.ч. формы и общих модулях с признаком `Клиент`.
8. Обработка ошибок:
   - Проверять все возвращаемые ошибки
   - Добавлять контекст к ошибке перед возвращением
   - Использовать [https://bugboard.v8.1c.ru/](https://bugboard.v8.1c.ru/) для проверки известных ошибок конфигураций и платформы
9. Логирование:
   - Использовать структурированное логирование (ЗаписьЖурналаРегистрации)
   - Различать уровни логирования (Отладка, Информация, Предупреждение, Ошибка)
   - Не логировать чувствительную информацию
10. Тестирование:
    - Использовать проверку применимости изменений и расширений
    - Использовать типовые обработки тестирования для ERP - размещены на releases.1c.ru - открытия форм, проведения документов, записи справочников
11. Использование программ для проектирования прикладных решений - ArchiMate, 1C:СППР и тд.

## Вывод проекта в продакшн -- чеклист

1. На серверах 1С развернут мониторинг
2. Нет свежих необработанных ошибок в SonarQube
3. Установлена акутальная версия конфигурации и стабильная версия платформы 1С
4. Убедиться, что все сервера и системы имеют имя в dns и обращения к серверам происходят по доменным именам
5. Проверить, что для всех серверов прописаны статические IP
6. Наличие bug tracking - [AppSignal APM](https://appsignal.com), [Bugsnag](https://www.bugsnag.com), [Rollbar](http://rollbar.com/)
7. Наличие ротации логов - [logrotate](https://www.systutorials.com/docs/linux/man/5-logrotate.conf/)
8. Наличие бэкапа
9. Наличие пользовательской документации
10. Наличие инструкций по восстановлению после падения
11. Контроль доступов и защита от вторжений, настроена доменная авторизация в 1С
12. Выделены сервера, домены, ресурсы для production-test-development сред
13. Должен быть выстроен процесс обновления системы
14. ВСЕ службы, конфигурации, поставки 1С и сервисы зарегистрированы на компанию и оплачены
15. Исходный код отгружен в git-репозитарий\хранилище конфигурации 1С
16. Настроена отказоустойчивая инфраструктура
17. Проверена производительность под нагрузкой
18. Подготовлены групповые политики для обновления платформы 1С на стороне клиентов

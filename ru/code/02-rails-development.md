# Разработка Ruby on Rails приложений

## Язык программирования и структура проекта

В качестве языка программирования используется Ruby. Для управления версиями Ruby используется утилита mise (<https://mise.jdx.dev>), также в конфигурационном файле mise.toml прописываются все необходимые команды и переменные окружения.

Структура проекта должна соответствовать стандартной структуре Rails-приложения с соблюдением принципа «Convention over Configuration».

## Фреймворки

В качестве основного фреймворка используется Ruby on Rails.

| **Тип модуля** | **Название фреймворка** | **Ссылка на репозитарий и документацию** |
| -------------- | ----------------------- | ---------------------------------------- |
| Веб-приложение | Ruby on Rails           | <https://github.com/rails/rails>         |
|                |                         | <https://guides.rubyonrails.org/>        |

## Библиотеки

| **Решаемая задача**          | **Название библиотеки** | **Ссылка на репозитарий и документацию**          |
| ---------------------------- | ----------------------- | ------------------------------------------------- |
| Аутентификация               | Devise                  | <https://github.com/heartcombo/devise>            |
| Авторизация                  | Pundit                  | <https://github.com/varvet/pundit>                |
| Управление API               | Grape                   | <https://github.com/ruby-grape/grape>             |
| Загрузка файлов              | Shrine                  | <https://github.com/shrinerb/shrine>              |
| Фоновые задачи               | Sidekiq                 | <https://github.com/sidekiq/sidekiq>              |
| Инструменты для тестирования | RSpec, FactoryBot       | <https://github.com/rspec/rspec-rails>            |
|                              |                         | <https://github.com/thoughtbot/factory_bot_rails> |
| Форматирование кода          | RuboCop                 | <https://github.com/rubocop/rubocop-rails>        |
| Интернационализация          | I18n                    | <https://guides.rubyonrails.org/i18n.html>        |
| Пагинация                    | Pagy                    | <https://github.com/ddnexus/pagy>                 |

## Основные положения

1. Код должен соответствовать Ruby Style Guide (<https://rubystyle.guide/>) и Rails Style Guide (<https://rails.rubystyle.guide/>)
2. В проекте должна использоваться самая свежая стабильная версия Ruby и Ruby on Rails
3. В проекте должны использоваться самые свежие стабильные версии библиотек
4. Необходимо стараться сокращать количество внешних зависимостей для снижения количества точек отказа
5. Необходимо следовать принципам SOLID и DRY при разработке
6. Предпочтительно использовать паттерн Service Objects для инкапсуляции бизнес-логики
7. Для сложных форм применять паттерн Form Objects
8. Для сложных запросов к базе данных применять паттерн Query Objects
9. Использовать декораторы (например, Draper) для выделения презентационной логики
10. Выносить повторяющийся код в concerns или shared modules
11. Еженедельно для всех приложений, находящихся на поддержке, производится обновление зависимостей
12. Весь код должен быть покрыт тестами (минимальное покрытие — 85%)
13. Использовать RuboCop для статического анализа и форматирования кода
14. Использовать Brakeman для анализа безопасности кода
15. Во любых конфигурационных файлах **[запрещается]** использование IP за редким исключением - обязательно должны быть прописаны доменные имена для всех серверов
16. Код должен работать в выделенном docker-контейнере. Для проекта подготавливается отдельный docker-compose. При росте сложности проекта или при запросе клиента должна производиться миграция на k8s
17. Все асинхронные процессы выносятся в отдельный модуль с использованием Sidekiq
18. Все чувствительные данные (email, номер телефона, ИНН, СНИЛС, SSN итд) должны шифроваться перед отправкой в БД, а также удаляться из логов
19. Код должен быть изначально написан с поддержкой i18n
20. Должен использоваться APM (Skylight, New Relic, AppSignal) или Exceptions tracker
21. Должен использоваться мониторинг

## Вывод проекта в продакшн - чеклист

1. Тесты проходят
2. Нет ошибок линтера (RuboCop)
3. Зависимости обновлены (Bundle audit)
4. Все асинхронные задачи вынесены в отдельный воркер (Sidekiq)
5. Код проверен на уязвимости безопасности (Brakeman)
6. Проект имеет документацию API (если применимо) с использованием Swagger
7. Настроены корректные индексы в базе данных
8. Проведен аудит N+1 запросов с помощью bullet
9. Настроено кэширование (Redis, Memcached)
10. Настроена подсистема управления загруженными файлами
11. Убедиться, что все сервера и системы имеют имя в dns и обращения к серверам происходят по доменным именам
12. Проверить, что для всех серверов прописаны статические IP
13. Наличие мониторинга серверов
14. Наличие bug tracking - [AppSignal APM](https://appsignal.com), [Bugsnag](https://www.bugsnag.com), [Rollbar](http://rollbar.com/)
15. Наличие ротации логов - [logrotate](https://www.systutorials.com/docs/linux/man/5-logrotate.conf/)
16. Наличие бэкапа
17. Наличие документации
18. Наличие инструкций по восстановлению после падения
19. Контроль доступов и защита от вторжений
20. Выделены сервера, домены, ресурсы для production-prodlike-staging-development сред
21. Должен быть выстроен процесс обновления системы и зависимостей приложения
22. ВСЕ службы и сервисы зарегистрированы на компанию и оплачены
23. Исходный код отгружен в git-репозитарий
